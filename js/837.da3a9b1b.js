(self["webpackChunkAutumn"]=self["webpackChunkAutumn"]||[]).push([[837],{94837:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"page-bridge-wrap"},[s("div",{staticClass:"page-bridge_content"},[s("a-row",{attrs:{type:"flex",justify:"start",gutter:10}},[s("a-col",{attrs:{order:1,xs:{order:2,span:24},md:{order:2,span:24},lg:{order:1,span:8},xxl:{order:1,span:8}}},[s("div",{staticClass:"page-bridge_intro page-bridge_card"},[s("div",{staticClass:"title_big"},[e._v(" "+e._s(e.$t("default.bridge"))+" ")]),s("div",{staticClass:"title_sub"},[e._v(" "+e._s(e.$t("bridge.bridgeTip1"))+" ")]),s("div",{staticClass:"bridge-intro-raw"},[s("div",[s("svg-icon",{attrs:{iconClass:"HEXAGONAL"}})],1),s("span",[e._v(e._s(e.$t("bridge.introLine1")))])]),s("div",{staticClass:"bridge-intro-raw"},[s("div",[s("svg-icon",{attrs:{iconClass:"HEXAGONAL"}})],1),s("span",[e._v(e._s(e.$t("bridge.introLine2")))])]),s("div",{staticClass:"bridge-intro-raw"},[s("div",[s("svg-icon",{attrs:{iconClass:"HEXAGONAL"}})],1),s("span",[e._v(e._s(e.$t("bridge.introLine3")))])]),s("a",{staticStyle:{"margin-top":"80px"},attrs:{target:"_blank",href:e.$t("default.docUrl")}},[e._v(" "+e._s(e.$t("bridge.userGuide"))+" ")]),s("a",{staticStyle:{"margin-top":"20px"},on:{click:function(t){return e.$router.push("proof")}}},[e._v(" "+e._s(e.$t("bridge.checkDetail"))+" ")]),s("a",{staticStyle:{"margin-top":"20px"},attrs:{target:"_blank",href:e.$t("default.telegramUrl")}},[e._v(" "+e._s(e.$t("bridge.help"))+" ")])])]),s("a-col",{attrs:{order:2,xs:{order:1,span:24},md:{order:1,span:24},lg:{order:2,span:16},xxl:{order:2,span:16}}},[s("div",{staticClass:"page-bridge_main page-bridge_card"},[s("div",{staticClass:"assets",staticStyle:{"margin-top":"40px"}},[s("p",[e._v(e._s(e.$t("bridge.asset")))]),s("a-select",{staticStyle:{width:"100%"},attrs:{"default-value":e.assetsType},on:{change:e.assetsChange}},e._l(e.assetsList,(function(t){return s("a-select-option",{key:t.name,attrs:{value:t.name,disabled:t.disabled}},[s("svg-icon",{attrs:{"icon-class":t.name}}),e._v(" "+e._s(t.name)+" ")],1)})),1)],1),s("div",{staticClass:"assetsSwap"},[s("div",{staticClass:"assetsSwap_from"},[s("p",[e._v(e._s(e.$t("bridge.from")))]),s("div",{staticClass:"box"},[s("div",[s("svg-icon",{attrs:{"icon-class":e.assetsSwap.from.icon}}),e.assetsSwap.from.badge?s("div",{staticClass:"badge"},[e._v(" "+e._s(e.assetsSwap.from.badge)+" ")]):e._e()],1),s("div",[e._v(" "+e._s(e.assetsSwap.from.name)+" ")])])]),s("a-button",{attrs:{icon:"arrow-right"},on:{click:function(t){var s;s=[e.assetsSwap.to,e.assetsSwap.from],e.assetsSwap.from=s[0],e.assetsSwap.to=s[1]}}}),s("div",{staticClass:"assetsSwap_to"},[s("p",[e._v(e._s(e.$t("bridge.to")))]),s("div",{staticClass:"box"},[s("div",[s("svg-icon",{attrs:{"icon-class":e.assetsSwap.to.icon}}),e.assetsSwap.to.badge?s("div",{staticClass:"badge"},[e._v(" "+e._s(e.assetsSwap.to.badge)+" ")]):e._e()],1),s("div",[e._v(" "+e._s(e.assetsSwap.to.name)+" ")])])])],1),s("div",{staticClass:"number"},[s("p",[e._v(e._s(e.$t("bridge.amount"))+" "),s("span",{staticClass:"max-btn",on:{click:function(t){return e.maxAmount()}}},[e._v("MAX")])]),s("a-input",{attrs:{size:"large",maxLength:48,placeholder:e.$t("bridge.minAmount")+e.currentBridge.min,suffix:"TRON"===e.assetsSwap.to.id?"W"+e.assetsType:e.assetsType},model:{value:e.assetsAmount,callback:function(t){e.assetsAmount=t},expression:"assetsAmount"}}),s("p",{staticStyle:{"font-size":"12px"}},[e._v(" "+e._s(e.$t("bridge.walletBalance"))+" "),s("span",{staticClass:"balance-type"},[e._v(e._s("TRON"===e.assetsSwap.to.id?"W"+e.assetsType:e.assetsType))]),s("span",{staticClass:"balance-value"},[e._v(" "+e._s(e.$eventBus.humanFriendlyBalance("TRON"===e.assetsSwap.from.id?e.currentBridge.balance:e.currentBridge.HECOBalance,e.currentBridge.decimals,4))+" ")])]),s("p",{staticStyle:{"margin-top":"25px"}},[e._v(e._s(e.$t("bridge.targetAddress")))]),s("a-input",{attrs:{size:"large",maxLength:e.assetsSwap.to.addressLength,placeholder:e.$t("bridge.targetAddress")},model:{value:e.targetAddress,callback:function(t){e.targetAddress=t},expression:"targetAddress"}}),e.assetsAmount>=e.currentBridge.min?s("div",{staticClass:"number_get"},[e._v(" "+e._s(e.$t("bridge.uWillRecive"))+" = "),s("svg-icon",{attrs:{"icon-class":e.assetsType}}),e._v(" "+e._s(e.acceptAmount)+" "+e._s("HECO"===e.assetsSwap.to.id?"W"+e.assetsType:e.assetsType)+" "),"HECO"===e.assetsSwap.to.id?s("a-tooltip",{attrs:{placement:"topLeft"}},[s("template",{slot:"title"},[s("span",[e._v(e._s(e.$t("bridge.handlingFee")))])]),s("a-icon",{staticStyle:{"margin-left":"5px"},attrs:{type:"question-circle"}})],2):e._e()],1):e._e()],1),s("div",{staticClass:"flex-center submit"},["HECO"===e.assetsSwap.from.id&&!1===e.$eventBus.connected?s("a-button",{attrs:{block:"",type:"primary",size:"large"},on:{click:function(t){return e.$eventBus.connectWallet()}}},[e._v(" "+e._s(e.$t("default.connect"))+" ")]):s("a-button",{attrs:{block:"",type:"primary",size:"large",disabled:!e.submitCheck},on:{click:function(t){return e.confirm()}}},[e._v(" "+e._s(e.$t("bridge.confirm"))+" ")])],1)])])],1)],1)])},a=[];s(82526),s(41817),s(41539),s(32165),s(78783),s(33948),s(47042),s(68309),s(91038);function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,r=new Array(t);s<t;s++)r[s]=e[s];return r}function i(e,t){if(e){if("string"===typeof e)return n(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(e,t):void 0}}function o(e,t){var s;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=i(e))||t&&e&&"number"===typeof e.length){s&&(e=s);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,o=!0,c=!1;return{s:function(){s=e[Symbol.iterator]()},n:function(){var e=s.next();return o=e.done,e},e:function(e){c=!0,n=e},f:function(){try{o||null==s["return"]||s["return"]()}finally{if(c)throw n}}}}var c=s(9596),u=(s(35666),s(4723),s(74916),s(56977),s(47941),s(26833),{TRX:{source:"TPkUrLNFSKFaaNAK3FdvoaM4QQEJ6Xfntv",target:"0x9B2b638728bD08b0B021D678005e7003618Cc8c9",token:"",decimals:6,min:50,fee:30},SUN:{source:"TCawfB1LcouxZmhtZVLA2ZKjZnSCTpwoiB",target:"0x101E3ea91C002f3DBb4F5b512Ca083023bbcfa27",token:"TKkeiboTkxXKJpbmVFbv4a8ov5rAfRDMf9",decimals:18,min:.2,fee:.1},JST:{source:"TUeivuN6PexCJif6DBwNccP6AVThmX95MR",target:"0xBB2dC6FD96b2D00E17F152fDD0c06d101D6a263B",token:"TCFLL5dx5ZJdKnWuesXxi1VPwjLVmWZZy9",decimals:18,min:30,fee:20}}),d=u,l=s(52099),g=s(26064),m={name:"Bridge",data:function(){return{assetsType:"TRX",assetsList:[{name:"TRX",disabled:!1},{name:"SUN",disabled:!1},{name:"JST",disabled:!1},{name:"BTT",disabled:!0},{name:"USDJ",disabled:!0},{name:"PEARL",disabled:!0}],assetsSwap:{to:{id:"HECO",name:"Huobi ECO Chain",icon:"HECO",badge:"",addressLength:42},from:{id:"TRON",name:"TRON Network",icon:"TRX",badge:"",addressLength:34}},assetsAmount:"",assetGetToken:10,accountAddress:"",targetAddress:"",balanceTimer:null,hecoBalanceTimer:null,bridges:d}},computed:{submitCheck:function(){var e=(0,l.BigNumber)(this.assetsAmount).gte((0,l.BigNumber)(this.currentBridge.min)),t=!1,s=!1;return"TRON"===this.assetsSwap.to.id&&(this.targetAddress.match(/^T.{33}$/)&&(t=!0),(0,l.BigNumber)(this.currentBridge.HECOBalance).gte((0,l.BigNumber)(this.assetsAmount).times((0,l.BigNumber)(Math.pow(10,this.currentBridge.decimals))))&&(s=!0)),"HECO"===this.assetsSwap.to.id&&(this.targetAddress.match(/^(0x).{40}$/)&&(t=!0),(0,l.BigNumber)(this.currentBridge.balance).gte((0,l.BigNumber)(this.assetsAmount).times((0,l.BigNumber)(Math.pow(10,this.currentBridge.decimals))))&&(s=!0)),e&&t&&s},currentBridge:function(){return this.bridges[this.assetsType]},realAssetsAmount:function(){return(0,l.BigNumber)(this.assetsAmount).times((0,l.BigNumber)(Math.pow(10,this.currentBridge.decimals))).toFixed()},acceptAmount:function(){return"HECO"===this.assetsSwap.from.id?(0,l.BigNumber)(this.assetsAmount).toFixed():(0,l.BigNumber)(this.assetsAmount).minus((0,l.BigNumber)(this.currentBridge.fee)).toFixed()}},methods:{assetsChange:function(e){this.assetsType=e},maxAmount:function(){if("TRON"===this.assetsSwap.from.id){var e=this.getTronWeb();if(!0!==e)return;this.assetsAmount=(0,l.BigNumber)(this.currentBridge.balance).div((0,l.BigNumber)(Math.pow(10,this.currentBridge.decimals))).toFixed()}else this.$eventBus.connected&&(this.assetsAmount=(0,l.BigNumber)(this.currentBridge.HECOBalance).div((0,l.BigNumber)(Math.pow(10,this.currentBridge.decimals))).toFixed())},confirm:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$createElement,"TRON"!==e.assetsSwap.from.id){t.next=5;break}if(s=e.getTronWeb(),!0===s){t.next=5;break}return t.abrupt("return");case 5:e.$confirm({title:e.$t("bridge.confirmTargetAddress"),content:function(t){return t("div",{style:"color:red;"},[e.targetAddress])},onOk:function(){var t=(0,c.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("TRON"!==e.assetsSwap.from.id){t.next=4;break}return t.next=3,e.deposit(e.assetsType,e.realAssetsAmount,e.targetAddress).catch((function(t){console.log(t),e.$notification.error({message:e.$t("bridge.insufficientBalance"),description:e.$t("bridge.insufficientBalanceMsg"),duration:3e3})}));case 3:return t.abrupt("return",!0);case 4:if(e.$notification.success({message:e.$t("bridge.transaction_success"),description:e.$t("bridge.awaitingNodeConfirmation"),duration:3e3}),"HECO"!==e.assetsSwap.from.id){t.next=8;break}return t.next=8,e.burn();case 8:case"end":return t.stop()}}),t)})));function s(){return t.apply(this,arguments)}return s}(),onCancel:function(){console.log("Cancel")},class:"test"});case 6:case"end":return t.stop()}}),t)})))()},getTronWeb:function(){if(window.tronWeb){if(window.tronWeb.defaultAddress.base58)return this.accountAddress=window.tronWeb.defaultAddress.base58,!0;console.log("error"),this.$notification.error({message:this.$t("bridge.please_unlock_title"),description:this.$t("bridge.please_unlock_msg"),duration:0})}else this.$notification.error({message:this.$t("bridge.chainId_error_title"),description:this.$t("bridge.chainId_error_msg"),duration:0})},fetchMyBalance:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchBalanceOf(e.accountAddress);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},fetchBalanceOf:function(e){var t=this;return(0,c.Z)(regeneratorRuntime.mark((function s(){var r,a,n,i,c,u,d;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,fetch("https://api.trongrid.io/v1/accounts/"+e).then((function(e){return e.json()}));case 2:if(r=s.sent,a=r.data,a[0]&&(t.$set(t.bridges.TRX,"balance",a[0].balance),a[0].trc20)){n=o(a[0].trc20);try{for(n.s();!(i=n.n()).done;)for(c=i.value,u=0;u<Object.keys(t.bridges).length;u++)d=Object.keys(t.bridges)[u],t.bridges[d].token===Object.keys(c)[0]&&t.$set(t.bridges[d],"balance",(0,l.BigNumber)(Object.values(c)[0]).toFixed())}catch(g){n.e(g)}finally{n.f()}}case 5:case"end":return s.stop()}}),s)})))()},fetchHecoBalance:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){var s,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:for(s=function(){var t=a[r];e.$eventBus.fetchAssetBalance(t.target).then((function(s){e.$set(t,"HECOBalance",s)}))},r=0,a=Object.values(e.bridges);r<a.length;r++)s();case 2:case"end":return t.stop()}}),t)})))()},deposit:function(e,t,s){var r=this;return(0,c.Z)(regeneratorRuntime.mark((function a(){var n,i,o,c,u;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=d[r.assetsType],!n.token){a.next=16;break}return a.next=4,window.tronWeb.contract().at(n.token);case 4:return i=a.sent,a.next=7,i.allowance(r.accountAddress,r.currentBridge.source).call();case 7:if(o=a.sent,console.log("Approve",(0,l.BigNumber)(o).toFixed(),t),console.log("Allowed",o),!(0,l.BigNumber)(o).lt((0,l.BigNumber)(t))){a.next=16;break}return console.log("Approve"),a.next=14,i.approve(n.source,(0,l.BigNumber)(10).pow((0,l.BigNumber)(28)).toFixed()).send();case 14:a.sent,console.log("Approve Done");case 16:return a.next=18,window.tronWeb.contract().at(n.source);case 18:return c=a.sent,u=c.deposit(t,s),console.log("Send deposit"),a.next=23,u.send({feeLimit:1e8,callValue:"TRX"===e?t:0});case 23:r.$notification.destroy(),r.$notification.success({message:r.$t("default.transaction_submitted"),duration:3e3});case 25:case"end":return a.stop()}}),a)})))()},burn:function(){var e=this;return(0,c.Z)(regeneratorRuntime.mark((function t(){var s,r,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:s=new e.$eventBus.web3.eth.Contract(g.tS,e.currentBridge.target),r=s.methods.burn(e.targetAddress,e.realAssetsAmount).send(e.$eventBus.getTxParams()),r.on("transactionHash",(function(t){a=t,e.$notification.destroy(),e.$notification.success({message:e.$t("default.transaction_submitted"),description:function(s){return s("div",[s("a",{domProps:{href:"https://hecoinfo.com/tx/".concat(t),target:"_blank"}},e.$t("default.goCheck"))])},duration:0}),console.log("deposit submit, hash",t)})),r.off("receipt"),r.on("receipt",function(){var t=(0,c.Z)(regeneratorRuntime.mark((function t(s){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.assetsAmount=0,console.log("deposit success",s.transactionHash),e.$notification.destroy(),e.$notification.success({message:e.$t("default.transaction_success"),duration:2}),e.$emit("DEPOSIT_SUCCESS",s);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),r.off("error"),r.on("error",(function(t){e.$emit("DEPOSIT_FAILED",t),e.$notification.destroy(),a?e.$notification.error({message:e.$t("default.transaction_failed"),description:function(t){return t("div",[t("a",{domProps:{href:"https://hecoinfo.com/tx/".concat(a),target:"_blank"}},e.$t("default.goCheck"))])}}):e.$notification.open({message:e.$t("default.transaction_canceled")})}));case 7:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this,t=100,s=function s(){console.log("retry"),e.balanceTimer=setTimeout((0,c.Z)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,!window.tronWeb){r.next=8;break}if(!window.tronWeb.defaultAddress.base58){r.next=8;break}return e.accountAddress=window.tronWeb.defaultAddress.base58,clearTimeout(e.balanceTimer),r.next=7,e.fetchMyBalance();case 7:t=4e3;case 8:s(),r.next=15;break;case 11:r.prev=11,r.t0=r["catch"](0),t+=100,s();case 15:case"end":return r.stop()}}),r,null,[[0,11]])}))),t)},r=1e3,a=function t(){e.hecoBalanceTimer=setTimeout((0,c.Z)(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(s.prev=0,!e.$eventBus.connected){s.next=6;break}return clearTimeout(e.hecoBalanceTimer),r=4e3,s.next=6,e.fetchHecoBalance();case 6:t(),s.next=12;break;case 9:s.prev=9,s.t0=s["catch"](0),t();case 12:case"end":return s.stop()}}),s,null,[[0,9]])}))),r)};s(),a()},beforeDestroy:function(){clearTimeout(this.balanceTimer),clearTimeout(this.hecoBalanceTimer)},created:function(){var e=this;window.addEventListener("message",(function(t){t.data.message&&"tabReply"===t.data.message.action&&t.data.message.data.data.node&&"_"!==t.data.message.data.data.node.chain&&(e.$notification.destroy(),e.$notification.error({message:e.$t("bridge.chainId_error_title"),description:e.$t("bridge.chainId_error_msg"),duration:0})),t.data.message&&"setNode"===t.data.message.action&&(console.log("setNode event",t.data.message,"_"!==t.data.message.data.node.chain),"_"!==t.data.message.data.node.chain&&(e.$notification.destroy(),e.$notification.error({message:e.$t("bridge.chainId_error_title"),description:e.$t("bridge.chainId_error_msg"),duration:0})))}))}},f=m,p=s(25961),b=(0,p.Z)(f,r,a,!1,null,"56068f76",null),h=b.exports}}]);